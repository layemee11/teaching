# Windows: Active Directory

Active Directory (AD) --- это специализированная БД, которая хранит данные о:

- пользователях предприятия;
- компьютерах;
- сетевых принтерах;
- общих ресурсах в сети;
- и др. объектах в сети.

Контроллер AD --- Windows Server с установленной и настроенной AD DS (Active Directory Domain Services).

Рекомендует иметь как минимум 2 контроллера AD в одной локальной сети, причем они не должны располагаться на одном физическом сервере.

Работа AD существенно нагружает сервер. Поэтому не рекомендуется устанавливать другие роли, которые требуют значительных системных ресурсов (Remote Desktop Services, Windows System Update Service, Windows Deployment Services и т.д.).

Контроллеры AD тесно интегрируются с DNS. Это позволяет компьютерам быстро находить контроллеры AD (тип записей SRV) и другие ресурсы в сети.

Объекты в AD группируются в домены. Пример имени домена: `contoso.com`. Дочерние домены:

- `webservices.contoso.com`
- `it.contoso.com`
- `accounting.contoso.com`

Дерево доменов --- это набор из корневого домена и его дочерних доменов.

Несколько деревьев доменов, которые доверяют друг другу, образуют лес.

Объекты в AD реплицируются между контроллерами AD в пределах одного домена.

Администратор леса настраивает обмен данными между доменами в лесу.

RODC --- Read-Only Domain Controller --- специализированный контроллер домена на котором невозможно создать новые объекты AD.

Каждый объект в AD относиться к какому-либо классу (пользователь, компьютер и т.д.). В зависимости от этого, у объекта имеется тот или иной набор атрибутов. Часто атрибуты имеют сокращённое название:

- `CN` --- common name
- `DC` --- domain component
- `OU` --- organization unit

Объекты могут иметь несколько значений для одного и того же атрибута. При этом, имеет значение порядок следования этих значений. Пример: `CN=user,DC=corp,DC=fiit,DC=ru`.

У каждого объекта должно быть уникальное (отличительное) имя --- Distinguished Name --- по которому его можно однозначно найти в AD.

Схема AD --- метаинформация о структуре объектов в AD. Схема AD единая для всего леса.

В лесу обязательно есть один (и только один) контроллер домена на котором можно внести изменения в схему AD. Он называется хозяин схемы (Master Schema).

Роль хозяина схемы может быть передана, или если текущий хозяин схемы недоступен, то она может быть перехвачена.

В AD происходит безопасная проверка пароля пользователя на контроллере AD с помощью протокола Kerberos. На клиентском компьютере после введения в AD
сохраняются локальные пользователи. Таким образом на любом компьютере в AD существует два набора пользователей:

- доменные пользователи (из AD);
- локальные.

Пользователь домена AD может быть идентифицирован двумя способами:

- с помощью NETBIOS-имени домена: `CONTOSO\ivanov`;
- с помощью имени домена: `ivanov@contoso.com`.

Локальный пользователь идентифицируется с помощью NETBIOS-имени компьютера: `COMP\ivanov`.

Глобальный каталог --- роль контроллера домена, которая позволяет хранить данные других доменов из нашего леса для ускорения доступа к ним.

SID --- Security identifier --- внутренний идентификатор безопасности, который присваивается пользователям и компьютерам.

SID --- уникален для каждого вновь создаваемого объекта.

Права на доступ назначаются для SID-ов.

Группа безопасности --- группы в которые входят пользователи или другие группы. ГБ нужны для более гибкого назначения прав доступа.

Контейнер --- средство группировки объектов в AD.

Классы объектов в AD --- компьютеры, пользователи, и т.д. Классы объектов отличаются друг от друга набором атрибутов.

Подразделение (Organization Unit, OU) --- специальный контейнер который может являться субъектом GPO (Group Policy Object).

Сайт --- в терминах AD это область сети где все контроллеры доменов связаны быстрым, надежным и недорогим соединением. Сайты нужны для более корректной репликации данных между контроллерами доменов.

Средства управления AD:

- оснастка MMC:

  * Пользователи и компьютеры AD, (AD Users and Computer ADUC);
  * ADSIedit.msc --- низкоуровневое редактирование объектов AD.

- метро-интерфейс

  * AD Administrative Center (ADAC);
  * Центр администрирование AD.

GPO (Group Policy Object) --- набор правил определяющий поведение компьютеров в домене

- Управление ГП;
- Редактор управления ГП.

Существующие в AD группы безопасности:

- Администраторы (не в домене) --- локальная группа, которая управляет компьютером;
- Администраторы домена --- управляет объектами в домене;
- Администраторы предприятия --- управляет объектами в любом домене леса;
- Администраторы схемы --- может вносить изменения в схему AD;
- Пользователи домена.

После добавления компьютера к домену распространенной практикой является добавление пользователя которому администратор доверяет в локальную группу администраторов. Таким образом данный пользователь получает право управлять данным компьютером и, например, устанавливать ПО.

Область распространения групп безопасности:

- Локальная в домене (Domain Local, DL) --- действует в пределах домена;
- Глобальные (Global, G) --- действует в пределах леса;
- Универсальные (Universal U) --- действуют в пределах лесов с доверительными соотношениями.

Рекомендуемая схема назначения прав доступа к ресурсам:

- I  --- Identity (пользователи);
- G  --- Global (роли пользователей);
- DL --- Domain-Local (права доступа);
- A  --- Access (ресурс).

Задание на практику:

- поднять контроллер домена;
- настроить доступ;

  * создать 3 пользователей;
  * включить их в группу операторы архива, для того чтобы они могли аутентифицироваться на контроллере домена;
  * создать группы безопасности;
  * создать 2 общие папки;
  * настроить доступ.

- изменить групповую политику так, чтобы у пользователей домена назначался определенный фон рабочего стола.
