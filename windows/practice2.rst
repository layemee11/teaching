===============================
Windows: Модификация WIM-файлов
===============================

-----------
Цели работы
-----------

- Научиться внедрять драйверы в загрузочный образ Windows.
- Научиться внедрять обновления в установочный образ Windows.
- Получить навыки работы в командной строке Windows.

----------------------
Работа с утилитой DISM
----------------------

Windows Imaging Format (WIM) --- это формат файлов, хранящий образы дисков. Формат был разработан компанией Microsoft для 
установки релизов операционных систем семейства Windows начиная с версии Windows Vista и Windows Server 2008, которые 
используют его как часть стандартной процедуры установки.

В WIM-файле может хранится несколько различных образов. Формат предусматривает эффективное сжатие данных позволяющее исключить 
дублирование одинаковых файлов из разных образов.

Инсталляционные дистрибутивы содержат по два WIM-файла:

- ``boot.wim`` --- хранит загрузочные образы, которые используются во время установки системы.
- ``install.wim`` --- хранит установочные образы, которые содержат файлы предназначенные для копирования в новую систему.

Утилита ``dism.exe`` это консольная программа для управления образами ``.wim``. С помощью нее можно подключать (монтировать) образа из WIM-файла, добавлять в образа дополнительные пакеты, интегрировать драйверы, выполнять настройку образа и затем снова упаковывать измененный образ в ``.wim``-файл. Для того чтобы она работала корректно необходимо чтобы она была запущена из командной строки с администраторскими правами доступа.

Подробная документация по ``dism.exe`` доступна на `странице на сайте документации Microsoft <https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/dism---deployment-image-servicing-and-management-technical-reference-for-windows>`_.

------------------------------------
Изучение параметров командной строки
------------------------------------

Создайте отчет о проделанной работе в виде документ Google Docs и откройте доступ для преподавателя.

Законспектируйте назначение следующих ключей командной строки утилиты ``dism``:

- ``dism /Online``
- ``dism /Image``
- ``dism /Get-WimInfo``
- ``dism /Commit-Wim``
- ``dism /Unmount-Wim``
- ``dism /Mount-Wim``
- ``dism /Get-Drivers``
- ``dism /Get-DriverInfo``
- ``dism /Add-Driver``
- ``dism /Remove-Driver``
- ``dism /Get-Features``
- ``dism /Get-FeatureInfo``
- ``dism /Enable-Feature``
- ``dism /Disable-Feature``

-----------------------------------------------------------------------
Внедрение драйверов и обновлений в загрузочный образ Windows (boot.wim)
-----------------------------------------------------------------------

- Откройте командную строку с правами администратора.
- Пользуясь средствами командной строки скопируйте файл sources/boot.wim с инсталляционного диска на жесткий диск.
- Пользуясь средствами командной строки создайте пустой каталог на жестком диске.
- С помощью утилиты ``dism`` определите сколько образов храниться в ``boot.wim``. Скопируйте использованную команду с её аргументами и результат её работы в отчет.
- С помощью утилиты ``dism`` подключите образ с индексом 2 из ``boot.wim`` ко вновь созданному пустому каталогу. Скопируйте использованную команду с её аргументами и результат её работы в отчет.
- Найдите на `сайте Intel <https://www.intel.com>`_ драйвер для контроллера Intel USB 3, скачайте наиболее подходящую версию и распакуйте архив с драйвером.
- С помощью утилиты ``dism`` добавьте драйвер в подключенный образ. Скопируйте использованную команду с её аргументами и результат её работы в отчет.
- Найдите на сайте компании Microsoft пакет обновлений KB2919442 для Windows Server 2012 R2.
- Отключите образ от каталога с сохранением изменений. Сравните размеры и даты измененного и оригинального файла ``boot.wim``, результаты добавьте в отчет.
